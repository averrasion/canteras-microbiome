{
  "hash": "3976d20a9012e5db92bb11c31cf9697e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Eukaryotes\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(here)\n\nsource(here(\"_common.R\"))\n\nsamples <- \n  read_csv(here(\"data\", \"samples.csv\"), col_types = cols(location = col_factor(levels = locations))) |>\n  mutate(date = make_datetime(year, month, day)) |> \n  mutate(season = make_season(date))\n\neukaryotes <- \n  read_csv(here(\"data\", \"eukaryotes.csv\")) |> \n  left_join(samples, by = join_by(sample)) |> \n  group_by(asv) |> \n  mutate(encounters = n(), .after = asv) |> \n  mutate(encounter_rate = encounters / 47, .after = encounters) |> \n  ungroup() |> \n  mutate(\n    rarity = \n      encounters |> case_match(1 ~ \"singular\", 47 ~ \"ubiquitous\", .default = \"recurring\"),\n    rarity = rarity |> fct(levels = c(\"singular\", \"recurring\", \"ubiquitous\")),\n    .after = encounter_rate\n  ) |> \n  group_by(sample) |> \n  mutate(p = reads / sum(reads), .after = reads) |> \n  ungroup()\n```\n:::\n\n## Overview\n\n::: {.cell}\n\n```{.r .cell-code}\neukaryotes |> \n  filter_analysis() |> \n  mutate(order = fct_lump_n(order, 11)) |> \n  group_by(season, order) |> \n  summarize(reads = sum(reads), .groups = \"drop_last\") |> \n  mutate(pi = reads / sum(reads)) |> \n  ggplot(aes(x = season, y = pi, fill = order)) +\n  scale_fill_brewer(palette = \"Set3\") +\n  geom_col(color = \"black\", linewidth = .3) +\n  scale_x_discrete(labels = labels_season) +\n  scale_y_continuous(labels = scales::percent) +\n  labs(x = \"\", y = \"relative abundance\", fill = \"\") +\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![](eukaryotes_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\neukaryotes |> \n  filter_analysis() |> \n  mutate(order = fct_lump_n(order, 11)) |> \n  group_by(location, order) |> \n  summarize(reads = sum(reads), .groups = \"drop_last\") |> \n  mutate(p = reads / sum(reads)) |> \n  ggplot(aes(x = p, y = fct_rev(location), fill = order)) +\n  scale_fill_brewer(palette = \"Set3\") +\n  geom_col(color = \"black\", linewidth = .3) +\n  scale_y_discrete(labels = labels_location) +\n  scale_x_continuous(labels = scales::percent) +\n  labs(x = \"relative abundance\", fill = \"\", y = \"\") +\n  theme_classic() +\n  theme()\n```\n\n::: {.cell-output-display}\n![](eukaryotes_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n## Rarity composition\n\n::: {.cell}\n\n```{.r .cell-code}\neukaryotes |> \n  count(\n    sample, location, season,\n    taxon = fct(class) |> fct_lump(9) |> fct_na_value_to_level(\"Other\"),\n    bins = encounter_rate |> cut_width(.25, center = .25/2),\n    wt = reads, name = \"p\"\n  ) |> \n  filter_analysis() |> \n  filter(taxon != \"Other\") |> \n  ggplot(aes(x = bins, y = p)) +\n  geom_boxplot(outliers = F) +\n  facet_wrap(~ taxon, scales = \"free_y\") +\n  labs(x = \"encounter\", y = \"relative abundance\") +\n  theme_classic() +\n  theme(axis.text.x = element_text(angle = 30, vjust = .5))\n```\n\n::: {.cell-output-display}\n![](eukaryotes_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n::: {.cell}\n\n```{.r .cell-code}\n# eukaryotes |> \n#     count(\n#         rarity = encounter_rate |> cut_width(.25, center = .25/2),\n#         supergroup,\n#         order,\n#         wt = reads, name = \"reads\"\n#     ) |> \n#   ggplot(aes(x = supergroup, y = reads, fill = rarity)) +\n#   geom_point() +\n#   facet_wrap()\n```\n:::\n\n\n",
    "supporting": [
      "eukaryotes_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}