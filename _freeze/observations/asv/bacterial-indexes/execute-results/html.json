{
  "hash": "240682411fa78b18a48561409c6ebebc",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Bacterial indexes\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(here)\n\nsource(here(\"_common.R\"))\n\nsamples <- \n  read_csv(here(\"data\", \"samples.csv\"), col_types = cols(location = col_factor(levels = locations))) |>\n  mutate(date = make_datetime(year, month, day)) |> \n  mutate(season = make_season(date))\n\nindexes <-\n  read_csv(here(\"data\", \"prokaryotes.csv\")) |> \n  left_join(samples, by = join_by(sample)) |> \n  group_by(sample, location, date, season) |> \n  summarize(\n    alpha           = sum(reads[class    == \"Alphaproteobacteria\"], na.rm = T),\n    gamma           = sum(reads[class    == \"Gammaproteobacteria\"], na.rm = T),\n    alteromonas     = sum(reads[genus    == \"Alteromonas\"],         na.rm = T),\n    sar11           = sum(reads[order    == \"SAR11 clade\"],         na.rm = T),\n    oceanospirillum = sum(reads[order    == \"Oceanospirillum\"],     na.rm = T),\n    bacteroidetes   = sum(reads[phylum   == \"Bacteroidota\"],        na.rm = T),\n    nitrospira      = sum(reads[phylum   == \"Nitrospirota\"],        na.rm = T),\n    burkholderiales = sum(reads[order    == \"Burkholderiales\"],     na.rm = T),\n    bacilli         = sum(reads[class    == \"Bacilli\"],             na.rm = T),\n    clostridia      = sum(reads[class    == \"Clostridia\"],          na.rm = T)\n  ) |> \n  mutate(\n    index_as   = (alteromonas) / sar11,\n    index_aos  = (alteromonas + oceanospirillum) / sar11,\n    index_bngb = (bacteroidetes + nitrospira + gamma) / burkholderiales,\n    index_bbca = (bacilli + bacteroidetes + clostridia) / alpha\n  ) |> \n  pivot_longer(starts_with(\"index\"), names_to = \"index\", names_prefix = \"index_\")\n```\n:::\n\n| Index | Formula | Reference |\n|-------|:--------------------------:|------------------|\n| A:S      | $\\frac{\\text{Alteromonas}}{\\text{SAR11}}$                                          | [@ferrera2016] |\n| AO:S     | $\\frac{\\text{Alteromonas+Oceanospirillum}}{\\text{SAR11}}$                          | [@ferrera2016] |\n| BNγ:β    | $\\frac{\\text{Bacteroidetes+Nitrospira+γ-Proteobacteria}}{\\text{β-Proteobacteria}}$ | [@garrido2014] |\n| BBC:α    |  $\\frac{\\text{Bacilli+Bacteroidetes+Clostridia}}{\\text{α-Proteobacteria}}$         | [@wu2010]      |\n \n## Overview\n\n::: {.cell}\n\n```{.r .cell-code}\nindexes |> \n  filter(value > 0) |> \n  ggplot(aes(x = value, fill = index)) +\n  geom_density(color = \"black\", alpha = .5) +\n  labs(x = \"\", y = \"Density\", fill = \"\", color = \"\") +\n  scale_x_log10() +\n  scale_fill_discrete(labels = labels_index) +\n  theme_classic() +\n  theme(legend.position = \"inside\", legend.position.inside = c(.2, .7))\n```\n\n::: {.cell-output-display}\n![](bacterial-indexes_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n### Distribution\n\n::: {.cell}\n\n```{.r .cell-code}\nindexes |>\n  filter(value > 0) |> \n  filter_analysis() |> \n  ggplot(aes(y = fct_rev(location), x = value)) +\n  geom_boxplot(outliers = F) +\n  facet_wrap(~ index, scales = \"free_x\", labeller = as_labeller(labels_index)) +\n  scale_y_discrete(labels = labels_location) +\n  labs(x = \"\", y = \"\") +\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![](bacterial-indexes_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nindexes |>\n  filter(value > 0) |> \n  filter_analysis() |> \n  ggplot(aes(x = date, y = value, shape = location, color = location)) +\n  geom_jitter() +\n  facet_wrap(~ index, scales = \"free_y\", labeller = as_labeller(labels_index)) +\n  scale_color_discrete(labels = labels_location) +\n  scale_shape_discrete(labels = labels_location) +\n  labs(x = \"\", y = \"\", shape = \"\", color = \"\") +\n  theme_classic() +\n  theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](bacterial-indexes_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nindexes |>\n  filter(value > 0) |> \n  filter_analysis() |> \n  ggplot(aes(x = season, y = value)) +\n  geom_boxplot(outliers = F) +\n  facet_wrap(~ index, scales = \"free_y\", labeller = as_labeller(labels_index)) +\n  scale_x_discrete(labels = labels_season) +\n  labs(x = \"\", y = \"\", shape = \"\", color = \"\") +\n  theme_classic() +\n  theme(axis.text.x = element_text(angle = 20, vjust = .5))\n```\n\n::: {.cell-output-display}\n![](bacterial-indexes_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n",
    "supporting": [
      "bacterial-indexes_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}